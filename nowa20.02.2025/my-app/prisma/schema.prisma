// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ============================================================================
// SYSTEM I UÅ»YTKOWNICY - zarzÄ…dzanie uÅ¼ytkownikami i logowanie zdarzeÅ„
// ============================================================================

model User {
  id Int @id @default(autoincrement())

  //logowanie
  login    String @unique
  password String

  //osoba
  username    String @default("default_username")
  userSurname String @default("default_surname")

  //daty tworzenia i aktualizacji
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  //dostepy
  permissions Permission[] @relation("UserPermissions")
}

//MODEL DOSTÄ˜PU DO RÃ“Å»NYCH MODUÅÃ“W
model Permission {
  id          Int    @id @default(autoincrement())
  name        String @unique
  href        String
  description String
  users       User[] @relation("UserPermissions")
}

// ============================================================================
// MODELE PODSTAWOWE (SÅOWNIKI) - dane referencyjne
// ============================================================================

model Product {
  id   Int    @id @default(autoincrement())
  name String

  // Relacja do partii produkcji, ktÃ³re dotyczÄ… danego produktu
  productionBatches ProductionBatch[]
}

model Supplier {
  id   Int    @id @default(autoincrement())
  name String

  // Relacja do partii produkcji zwiÄ…zanych z dostawcÄ…
  productionBatches ProductionBatch[]
}

model Recipient {
  id   Int    @id @default(autoincrement())
  name String

  // Relacja do partii produkcji, gdzie wystÄ™puje odbiorca
  productionBatches ProductionBatch[]
}

model Machine {
  id    Int    @id @default(autoincrement())
  name  String
  color String

  // Relacja do partii, ktÃ³re byÅ‚y liofilizowane przy uÅ¼yciu danej maszyny
  productionBatches ProductionBatch[]
}

// ============================================================================
// MODELE GÅÃ“WNE - operacje biznesowe
// ============================================================================

// ğŸ Model Frakcji - mÃ³wi nam jak zostaÅ‚ pociÄ™ty/przetworzony produkt
// Frakcje to np. "CaÅ‚y owoc", "Kostka", "Plasterki" itp.
model Fraction {
  id          Int     @id @default(autoincrement()) // Unikalny numerek kaÅ¼dej frakcji
  name        String  @unique // Nazwa frakcji, np. "Kostka"
  description String? // Opis frakcji (opcjonalny)

  // ğŸ”„ PowiÄ…zanie: Tutaj Å‚Ä…czymy frakcjÄ™ z partiami produktÃ³w
  productionBatches ProductionBatch[]
}

// ğŸ“‹ Model Statusu Partii - Å›ledzi gdzie aktualnie znajduje siÄ™ nasz produkt
// Statusy to np. "PrzyjÄ™ty", "W mroÅºni", "W procesie liofilizacji", "Gotowy"
model BatchStatus {
  id          Int     @id @default(autoincrement()) // Unikalny numerek kaÅ¼dego statusu
  name        String  @unique // Nazwa statusu, np. "W mroÅºni"
  description String? // Dodatkowy opis statusu
  color       String? @default("#808080") // Kolor do wyÅ›wietlania w aplikacji

  // ğŸ”„ PowiÄ…zanie: Tutaj Å‚Ä…czymy status z partiami produktÃ³w
  productionBatches ProductionBatch[]
}

// ğŸ­ GÅ‚Ã³wny model Partii Produkcyjnej - najwaÅ¼niejszy model!
// Åšledzi caÅ‚Ä… "przygodÄ™" produktu od przyjÄ™cia do magazynu gotowych produktÃ³w
model ProductionBatch {
  id Int @id @default(autoincrement())

  // ğŸ”‘ Numer partii - najwaÅ¼niejszy identyfikator, np. "01-05-2023"
  batchNumber String @unique

  // ğŸ”— PowiÄ…zania z innymi modelami
  product    Product?  @relation(fields: [productId], references: [id]) // Co to za produkt?
  productId  Int?
  supplier   Supplier? @relation(fields: [supplierId], references: [id]) // Kto nam to dostarczyÅ‚?
  supplierId Int?

  // ğŸ“Š Status i Frakcja
  status     BatchStatus? @relation(fields: [statusId], references: [id]) // Gdzie teraz jest produkt?
  statusId   Int?
  fraction   Fraction?    @relation(fields: [fractionId], references: [id]) // Jak zostaÅ‚ pociÄ™ty?
  fractionId Int?

  // â° Daty procesu - kiedy co siÄ™ dziaÅ‚o z naszym produktem
  createdAt               DateTime  @default(now()) // Kiedy zaczÄ™liÅ›my Å›ledziÄ‡ partiÄ™
  scheduledDate           DateTime? // Kiedy zaplanowaliÅ›my liofilizacjÄ™
  freezerInDate           DateTime? // Kiedy produkt trafiÅ‚ do mroÅºni
  freezerOutDate          DateTime? // Kiedy wyjÄ™liÅ›my z mroÅºni do liofilizacji
  lyophilizationStartDate DateTime? // Start suszenia (liofilizacji)
  lyophilizationEndDate   DateTime? // Koniec suszenia
  fractioningDate         DateTime? // Kiedy produkt zostaÅ‚ pociÄ™ty
  qualityControlDate      DateTime? // Data kontroli jakoÅ›ci
  finalProductDate        DateTime? // Kiedy staÅ‚ siÄ™ gotowym produktem

  // âš–ï¸ Wagi i iloÅ›ci - Å›ledzenie zmian wagi podczas procesu
  initialWeight            Float? // Ile waÅ¼yÅ‚ na poczÄ…tku
  postLyophilizationWeight Float? // Ile waÅ¼y po wysuszeniu
  dryMassPercentage        Float? // Procent suchej masy (wyliczony automatycznie)
  rejectedWeight           Float? // Ile odrzuciliÅ›my podczas kontroli jakoÅ›ci
  finalWeight              Float? // Ostateczna waga produktu

  // ğŸ“ Historia zmian - pamiÄ™tnik przygÃ³d naszego produktu
  statusHistory      StatusChange[] // Wszystkie zmiany statusu
  inventoryMovements InventoryMovement[] // PrzesuniÄ™cia miÄ™dzy magazynami

  // ğŸ“ Miejsce na notatki i uwagi
  notes       String?
  Recipient   Recipient? @relation(fields: [recipientId], references: [id])
  recipientId Int?
  Machine     Machine?   @relation(fields: [machineId], references: [id])
  machineId   Int?
}

// ğŸ“œ Historia zmian statusu - zapisuje kaÅ¼dÄ… zmianÄ™ statusu partii
// Np. kiedy produkt przeszedÅ‚ z "W mroÅºni" do "W liofilizacji"
model StatusChange {
  id Int @id @default(autoincrement())

  // ğŸ”— PowiÄ…zanie z partiÄ… produkcyjnÄ…
  batch   ProductionBatch @relation(fields: [batchId], references: [id])
  batchId Int

  // Informacje o zmianie statusu
  oldStatus String? // Poprzedni status
  newStatus String // Nowy status
  changedAt DateTime @default(now()) // Kiedy nastÄ…piÅ‚a zmiana
  changedBy String // Kto zmieniÅ‚ status
  notes     String? // Opcjonalne uwagi
}

// ğŸ”„ PrzesuniÄ™cia magazynowe - Å›ledzenie ruchu produktu miÄ™dzy magazynami
// Np. przesuniÄ™cie z mroÅºni do hali produkcyjnej
model InventoryMovement {
  id Int @id @default(autoincrement())

  // ğŸ”— PowiÄ…zanie z partiÄ… produkcyjnÄ…
  batch   ProductionBatch @relation(fields: [batchId], references: [id])
  batchId Int

  // Informacje o przesuniÄ™ciu
  sourceLocation String // SkÄ…d? (np. "MroÅºnia")
  targetLocation String // DokÄ…d? (np. "Produkcja")
  weight         Float // Ile kilogramÃ³w przesuniÄ™to
  movedAt        DateTime @default(now()) // Kiedy przesuniÄ™to
  movedBy        String // Kto przesunÄ…Å‚
  notes          String? // Opcjonalne uwagi
}
